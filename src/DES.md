> # 数据加密标准 (DES)

## DES 设计参数

* 块（明文和密文）长度为64位
* 主密钥长度为64位
  * 但其中8位是奇偶校验位，所以有效密钥长度是56位。
* DES 由16轮构成，每轮使用一个由主密钥派生出的循环密钥（也叫子密钥）
  * 子密钥长度为48位，从56位密钥通过**密钥调度**派生而来。



## DES 操作符号

* 位串块的循环移位：用 `b<<<n` 表示块b的位向左移动n。移出的位被添加到b的右侧。

  * 如：
    $$
    11000011 <<< 3 = 00011110
    $$
    

* 位的位置排列：写成输入位的输出顺序。
  * 如，排列`4123`表示：
    * 第四个输入位成为第一输出位
    * 第一个输入位成为第二输出位
    * ……
  * 我们使用 “排列”一词来表示位的重新排列，其中包括位的重复或丢弃，尽管这并不是一种正确的排列。



## 加密

<img src="img\DES Overview.png" style="zoom: 50%;" />

1. [初始置换（IP）]([DES补充材料 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/DES补充材料#初始置换(IP,_Initial_permutation))

2. 每一轮的操作
   - 将输入分成两等份 $M = (L_0,R_0)$

   - 对右半部分应用费斯妥函数 

   - 将结果与旧的左半部计算异或，成为新的左半部

   - 交换旧的右半部分和新的左半部分，除非我们处于最后一轮

     

     意即：

     对于每一轮
     $$
     i = 1,2,...,16
     $$
     计算
     $$
     L_i =& R_{i-1} \\
     R_i =& L_{i-1} \oplus F(K_i, R_{i-1})
     $$

   最后得到 $C = (R_{16}, L_{16})$

3. [最终置换（FP 或 IP<sup>-1</sup>）]([DES补充材料 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/DES补充材料#最终置换_(IP-1))



## 解密

与加密一样，但子密钥顺序相反

1. 最终置换（ FP或IP<sup>-1 </sup>）

2. 每一轮的操作

   * 将输入分成两等份 $C = (R_{16}, L_{16})$

   * 对于每一轮

   $$
   i = 16，15，...，1
   $$

   ​     计算
   $$
   R_{i-1} =& L_{i} \\
   L_{i-1} =& R_{i} \oplus F(K_i, L_{1})
   $$

   ------

   > ​     加密公式

   $$
   L_i =& R_{i-1} \\
   R_i =& L_{i-1} \oplus F(K_i, R_{i-1})
   $$

   

3. 初始置换（IP）



## 密钥调度

每一轮都有不同的密钥，由所谓的密钥调度计算得出

<img src="img\DES-key-schedule.png" alt="DES-key-schedule"  />

* 首先对主密钥应用 [PC-1]([DES补充材料 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/DES补充材料#选择置换1(PC-1)) 排列，去掉奇偶校验位。这样就得到了 56 比特
* 将结果分成两等分，得到 $(C_0,D_0)$
* 对于每一轮

$$
i = 1,2,...,16
$$

​       计算
$$
C_i =& C_{i-1} <<< p_{i} \\
D_i =& D_{i-1} <<< p_{i}
$$
​       其中
$$
p_i=
\begin{cases}
    1 & \text{如果 } i = 1,2,9,16 \\
    2 & \text{否则 }
\end{cases}
$$

- 现在，我们将 C<sub>i</sub> 和 D<sub>i</sub> 连接在一起，并使用 [PC-2]([DES补充材料 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/DES补充材料#选择置换2(PC-2)) 产生 48 位输出，得到 K<sub>i</sub>


## 费斯妥函数

<img src="img\DES-f-function.png" alt="DES-f-function" style="zoom: 150%;" />

1. [扩张置换（ E函数 ）]([DES补充材料 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/DES补充材料#扩张函数_(E函数))

   * 通过将 16 个位加倍并排列，将 32 位半块扩展为 48 位块

2. 子密钥加

   * 计算子密钥与这个48位块的异或

3. [S盒](https://zh.wikipedia.org/wiki/DES%E8%A1%A5%E5%85%85%E6%9D%90%E6%96%99#%E7%BD%AE%E6%8D%A2%E7%9B%92_(S%E7%9B%92))

   * 将 48 位分割成 8 个 6 位块。将 6 位块分别输入 8 个置换盒，由 4 位块置换出 6 位块。

   * DES的非线性操作，DES的核心

     * 什么是线性？
       $$
       f（a+b）=f(a)+f(b)
       $$

   * S盒是一个查找表，输入为6位，输出为4位。

     * 工作原理

       * 取出第一位和最后一位并连接它们，这个两位数字是行索引
       * 四个内部位表示列号

       * 输出是表中相应的条目

   *  ~~它有以下约束条件：~~

     * ~~任何一个输出位都不应过于接近输入位的线性组合~~
     * ~~如果 S 盒的两个输入位正好相差一个位，那么它们的输出位必须至少相差两个位~~
     * ~~如果 S盒 的两个输入位在中间两个位上不同，那么它们的输出位必须至少在两个位上不同~~
     * ~~如果 S 盒的两个输入在前两个位上不同，而在后两个位上相同，则 S 盒的输出必须至少有两个位不同。~~

4. [P盒](https://zh.wikipedia.org/wiki/DES补充材料#P置换)

   * 将这 8 个 4 位数据块合并为 32 位数据块，再进行一次排列。

## 混淆和扩散

* 混淆：密文的每个位都应取决于密钥的多个部分，从而模糊了两者之间的联系
* 扩散：如果我们改变明文的一个位，那么（从统计学角度看）密文中一半的位都应该改变

## 3DES

按照今天的标准，DES是不安全的。

### "2DES"

DES是一个很好的设计，但是由于它只有56位密钥，只有大约2^56^的安全性（有一些对DES的密码分析攻击，但不是很严重，所以我们说它的安全性大约是2^56^）。

对于 2DES：$Enc_{K_1}(Enc_{K_2}(M))$，安全性不会超过2^57^：

* 尝试所有2^56^个可能的密钥$K_2$，并将所有结果存储在 $Enc_{K2} (M)$ 中。2^56^用于加密，2^56^log(2^56^)用于排序（时间上的次要因素，忽略）。
* 尝试所有2^56^个可能的密钥$K_1$，计算$Dec{K_1} (C)$，检查它是否是存储的$Enc{K_2} (M)$之一。2^56^用于解密，log(2^56^)用于检查（对数级别，忽略）。

* $总工作量=2^{56}+2^{56}=2^{57}$

### 3DES 很好，但慢

$Enc{K_1}(Dec{K_2}(Enc{K_3}(M)))$

* 为什么是 Enc-Dec-Enc 而不是 Enc-Enc-Enc ？Enc-Dec-Enc 为我们提供了一个设置K~1~ = K~2~ = K~3~ 的选项，这相当于DES，所以如果你有3DES，你可以让它做DES，这在某些情况下可能很有用。
* 3DES为我们提供了多少安全性？它并没有给我们提供2^168^的安全性，因为与我们在“2DES”中遇到的相同的“中间相遇”攻击是可能的。据说它能给我们2^118^的安全性。